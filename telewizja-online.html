<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>MEGA TEST – 150+ KANAŁÓW OSOBNO</title>
  <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
  <style>
    body {background:#000;color:#fff;font-family:Arial;margin:0;padding:20px;}
    h1 {text-align:center;color:#0f0;font-size:50px;margin:30px 0;}
    .channel {margin:30px 0;background:#111;padding:20px;border-radius:15px;text-align:center;}
    .channel h2 {color:#ff2d95;margin:0 0 15px;font-size:24px;}
    .player {width:100%;max-width:1000px;height:500px;margin:0 auto;background:#000;border-radius:10px;overflow:hidden;}
    .status {margin-top:10px;font-size:18px;}
    .ok {color:#0f0;}
    .fail {color:#f00;}
  </style>
</head>
<body>

<h1>MEGA TEST – 150+ KANAŁÓW OSOBNO Z GITHUB</h1>
<p style="text-align:center;font-size:22px;">Każdy kanał ma swój player – zobacz, które działają!</p>
<a href="index.html" style="display:block;text-align:center;color:#0ff;font-size:20px;margin:20px;">← Powrót do strony głównej</a>

<div id="channels"></div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  fetch('playlist.m3u?' + Date.now())
    .then(r => r.text())
    .then(text => {
      const lines = text.split('\n');
      const container = document.getElementById('channels');
      let url = '';
      let name = 'Kanał';
      let id = 0;

      lines.forEach(line => {
        line = line.trim();
        if (line.startsWith('#EXTINF:')) {
          const match = line.match(/tvg-name="([^"]+)"/) || line.match(/,(.+)$/);
          name = match ? match[1].trim() : 'Kanał bez nazwy';
        } else if (line && line.includes('.m3u8')) {
          id++;
          url = line.startsWith('http') ? line : 'https://security.freefreaks.top/' + line;

          const div = document.createElement('div');
          div.className = 'channel';
          div.innerHTML = `
            <h2>${id}. ${name}</h2>
            <video id="player${id}" class="video-js player" controls preload="none"></video>
            <div class="status" id="status${id}">Ładowanie...</div>
          `;
          container.appendChild(div);

          const player = videojs(`player${id}`, {fluid: true, liveui: true});

          if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(player.tech_.el_);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
              player.play();
              document.getElementById(`status${id}`).innerHTML = '<span class="ok">DZIAŁA! Obraz + dźwięk</span>';
            });
            hls.on(Hls.Events.ERROR, () => {
              document.getElementById(`status${id}`).innerHTML = '<span class="fail">Błąd streamu</span>';
            });
          } else {
            player.src({type: 'application/x-mpegURL', src: url});
            player.ready(() => player.play());
            document.getElementById(`status${id}`).innerHTML = '<span class="ok">DZIAŁA (natywnie)</span>';
          }
        }
      });
    });
</script>

</body>
</html>
