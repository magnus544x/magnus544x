<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Moje Kanały TV</title>
  <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
  <style>
    body {background:#000;color:#fff;font-family:Arial;margin:0;padding:0;}
    .header {text-align:center;padding:20px;background:#111;}
    .header a {color:#0ff;font-weight:bold;text-decoration:none;}
    .container {display:flex;}
    #sidebar {width:300px;background:#111;overflow-y:auto;height:100vh;padding:10px;}
    .channel {margin:10px 0;}
    .channel h3 {cursor:pointer;color:#ccc;}
    .channel h3:hover {color:#fff;}
    #main {flex:1;padding:20px;}
    video {width:100%;max-width:800px;height:auto;display:none;}
    video.active {display:block;}
  </style>
</head>
<body>
  <div class="header">
    <h1>Moje Kanały TV</h1>
    <a href="https://security.freefreaks.top/playlist.m3u" download="playlist.m3u"><strong>Pobierz plik M3U</strong></a>
  </div>
  <div class="container">
    <div id="sidebar">Ładowanie kanałów...</div>
    <div id="main"></div>
  </div>

  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
  <script>
    const m3uUrl = 'https://security.freefreaks.top/playlist.m3u';
    let players = {};

    fetch(m3uUrl)
      .then(r => r.text())
      .then(text => {
        const lines = text.split('\n');
        const sidebar = document.getElementById('sidebar');
        const main = document.getElementById('main');
        let name = '', desc = '', url = '';

        lines.forEach(line => {
          line = line.trim();
          if (line.startsWith('#EXTINF:')) {
            const nameMatch = line.match(/tvg-name="([^"]+)"/);
            name = nameMatch ? nameMatch[1] : line.split(',').pop();
            const groupMatch = line.match(/group-title="([^"]+)"/);
            desc = groupMatch ? groupMatch[1] : '';
          } else if (line && line.includes('.m3u8')) {
            url = line;
            // Sidebar entry
            const sideEntry = document.createElement('div');
            sideEntry.className = 'channel';
            sideEntry.innerHTML = `<h3 onclick="showChannel('${name.replace(/'/g, "\\'")}', '${url.replace(/'/g, "\\'")}')">${name}</h3><p>${desc}</p>`;
            sidebar.appendChild(sideEntry);
            // Main player
            const playerDiv = document.createElement('div');
            playerDiv.innerHTML = `<h2>${name}</h2><video id="p_${name.replace(/[^a-zA-Z0-9]/g, '_')}" class="video-js" controls width="640" height="360"></video>`;
            main.appendChild(playerDiv);
            players[name.replace(/[^a-zA-Z0-9]/g, '_')] = videojs(`p_${name.replace(/[^a-zA-Z0-9]/g, '_')}`, {fluid: true});
            players[name.replace(/[^a-zA-Z0-9]/g, '_')].src({src: url, type: 'application/x-mpegURL'});
          }
        });
      });

    function showChannel(name, url) {
      document.querySelectorAll('video').forEach(v => v.style.display = 'none');
      const playerId = 'p_' + name.replace(/[^a-zA-Z0-9]/g, '_');
      document.getElementById(playerId).style.display = 'block';
      players[name.replace(/[^a-zA-Z0-9]/g, '_')].play();
      document.getElementById('main').scrollTo(0, 0);
    }
  </script>
</body>
</html>
