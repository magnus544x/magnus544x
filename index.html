<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Moje Kanały TV</title>
  <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
  <style>
    body {background:#000;color:#fff;font-family:Arial;margin:0;padding:20px;text-align:center;}
    h1 {margin-bottom:20px;}
    .channel {margin:20px 0;}
    .channel h3 {cursor:pointer;color:#ccc;}
    .channel h3:hover {color:#fff;}
    video {display:none; max-width:100%; margin-top:10px;}
    video.active {display:block;}
  </style>
</head>
<body>
  <h1>Moje Kanały TV</h1>
  <div id="channels"></div>

  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
  <script>
    const proxy = 'https://corsproxy.io/?';
    const m3uUrl = proxy + encodeURIComponent('https://security.freefreaks.top/playlist.m3u');
    let players = {};

    function loadPlaylist() {
      document.getElementById('channels').innerHTML = 'Ładowanie...';
      fetch(m3uUrl + '&t=' + Date.now())
        .then(r => r.text())
        .then(text => {
          const lines = text.split('\n');
          const div = document.getElementById('channels');
          div.innerHTML = '';
          let name = 'Nieznany';
          let url = '';

          for (let line of lines) {
            line = line.trim();
            if (line.startsWith('#EXTINF:')) {
              const match = line.match(/tvg-name="([^"]+)"/);
              name = match ? match[1] : line.split(',').pop();
            } else if (line && line.includes('.m3u8')) {
              url = line;
              const channelDiv = document.createElement('div');
              channelDiv.className = 'channel';
              channelDiv.innerHTML = `<h3 onclick="togglePlayer('${name.replace(/'/g, "\\'")}')">${name}</h3>`;
              const videoId = name.replace(/[^a-zA-Z0-9]/g, '_');
              channelDiv.innerHTML += `<video id="player_${videoId}" class="video-js" controls preload="auto" width="900" height="506" data-setup='{}'></video>`;
              div.appendChild(channelDiv);
              players[videoId] = videojs(`player_${videoId}`, {fluid: true});
              players[videoId].src({src: url, type: 'application/x-mpegURL'});
              url = '';
            }
          }
        })
        .catch(err => document.getElementById('channels').innerHTML = '<p>Błąd: ' + err + '</p>');
    }

    function togglePlayer(name) {
      const videoId = name.replace(/[^a-zA-Z0-9]/g, '_');
      Object.keys(players).forEach(id => {
        const v = document.getElementById('player_' + id);
        if (v) v.classList.remove('active');
        players[id].pause();
      });
      const activeV = document.getElementById('player_' + videoId);
      if (activeV) {
        activeV.classList.add('active');
        players[videoId].play();
      }
    }

    loadPlaylist();
    setInterval(loadPlaylist, 4 * 60 * 60 * 1000);
  </script>
</body>
</html>
